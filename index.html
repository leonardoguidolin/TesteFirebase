<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Projetos Acadêmicos</title>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-storage-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    section { display: none; margin-bottom: 30px; }
    #adminPanel, #perfilAluno { border: 1px solid #ccc; padding: 10px; }
    .projeto { border: 1px solid #aaa; padding: 10px; margin: 5px 0; }
    .linkAluno { color: blue; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Sistema de Projetos Acadêmicos</h1>

  <section id="loginSection">
    <h2>Login</h2>
    <input type="text" id="loginUsuario" placeholder="Usuário"><br>
    <input type="password" id="loginSenha" placeholder="Senha"><br>
    <button id="btnEntrar">Entrar</button>
  </section>

  <section id="adminPanel">
    <h2>Painel do Admin</h2>
    <h3>Cadastrar Aluno</h3>
    <input type="text" id="nomeAluno" placeholder="Nome"><br>
    <input type="email" id="emailAluno" placeholder="Email"><br>
    <button onclick="cadastrarAluno()">Cadastrar Aluno</button>

    <h3>Cadastrar Projeto</h3>
    <input type="text" id="tituloProjeto" placeholder="Título"><br>
    <textarea id="descricaoProjeto" placeholder="Descrição"></textarea><br>
    <input type="url" id="videoProjeto" placeholder="Link do vídeo YouTube"><br>
    <input type="file" id="pdfProjeto" accept="application/pdf"><br>
    <select id="alunosSelect" multiple></select><br>
    <button onclick="cadastrarProjeto()">Cadastrar Projeto</button>
  </section>

  <section id="publicView">
    <h2>Projetos Cadastrados</h2>
    <div id="listaProjetos"></div>
  </section>

  <section id="perfilAluno">
    <button id="btnVoltar">Voltar</button>
    <div id="dadosAluno"></div>
    <h3>Projetos Participantes</h3>
    <ul id="listaProjetosAluno"></ul>
  </section>

  <script>
    // Firebase config - substitua pelos dados reais do seu projeto
    const firebaseConfig = {
      apiKey: "AIzaSyDqXJZ-IvAwe4d5YJ7uwzFND7LtZtYzqKw",
      authDomain: "projetos-alunos.firebaseapp.com",
      projectId: "projetos-alunos",
      storageBucket: "projetos-alunos.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abc123def456"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Login simples
    const usuario = "admin";
    const senha = "1234";

    document.getElementById("btnEntrar").onclick = () => {
      const u = document.getElementById("loginUsuario").value;
      const s = document.getElementById("loginSenha").value;
      if (u === usuario && s === senha) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        carregarAlunos();
      } else {
        alert("Usuário ou senha incorretos!");
      }
    };

    async function cadastrarAluno() {
      const nome = document.getElementById("nomeAluno").value;
      const email = document.getElementById("emailAluno").value;
      if (nome && email) {
        await db.collection("alunos").add({ nome, email });
        alert("Aluno cadastrado!");
        document.getElementById("nomeAluno").value = "";
        document.getElementById("emailAluno").value = "";
        carregarAlunos();
      }
    }

    async function carregarAlunos() {
      const select = document.getElementById("alunosSelect");
      select.innerHTML = "";
      const snap = await db.collection("alunos").get();
      snap.forEach(doc => {
        const option = document.createElement("option");
        option.value = doc.id;
        option.textContent = doc.data().nome;
        select.appendChild(option);
      });
      listarProjetos();
    }

    async function cadastrarProjeto() {
      const titulo = document.getElementById("tituloProjeto").value;
      const descricao = document.getElementById("descricaoProjeto").value;
      const video = document.getElementById("videoProjeto").value;
      const alunosSelecionados = Array.from(document.getElementById("alunosSelect").selectedOptions).map(o => o.value);
      const pdfFile = document.getElementById("pdfProjeto").files[0];

      let pdfUrl = "";
      if (pdfFile) {
        const storageRef = storage.ref().child(`pdfs/${Date.now()}_${pdfFile.name}`);
        await storageRef.put(pdfFile);
        pdfUrl = await storageRef.getDownloadURL();
      }

      await db.collection("projetos").add({
        titulo, descricao, video, pdfUrl, alunos: alunosSelecionados
      });

      alert("Projeto cadastrado!");
      document.getElementById("tituloProjeto").value = "";
      document.getElementById("descricaoProjeto").value = "";
      document.getElementById("videoProjeto").value = "";
      document.getElementById("pdfProjeto").value = "";
      listarProjetos();
    }

    async function listarProjetos() {
      const container = document.getElementById("listaProjetos");
      container.innerHTML = "";
      const snap = await db.collection("projetos").get();
      for (const doc of snap.docs) {
        const data = doc.data();
        const div = document.createElement("div");
        div.className = "projeto";
        div.innerHTML = `
          <h4>${data.titulo}</h4>
          <p>${data.descricao}</p>
          ${data.video ? `<a href="${data.video}" target="_blank">Vídeo</a><br>` : ""}
          ${data.pdfUrl ? `<a href="${data.pdfUrl}" target="_blank">PDF</a><br>` : ""}
          <strong>Alunos:</strong> <span id="alunos-${doc.id}">Carregando...</span>
        `;
        container.appendChild(div);
        mostrarNomesAlunos(data.alunos, `alunos-${doc.id}`);
      }
    }

    async function mostrarNomesAlunos(ids, elementoId) {
      const span = document.getElementById(elementoId);
      const nomes = [];
      for (const id of ids) {
        const alunoDoc = await db.collection("alunos").doc(id).get();
        if (alunoDoc.exists) {
          nomes.push(`<span class=\"linkAluno\" onclick=\"abrirPerfilAluno('${id}')\">${alunoDoc.data().nome}</span>`);
        }
      }
      span.innerHTML = nomes.join(", ");
    }

    async function abrirPerfilAluno(id) {
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("publicView").style.display = "none";
      document.getElementById("perfilAluno").style.display = "block";

      const alunoDoc = await db.collection("alunos").doc(id).get();
      document.getElementById("dadosAluno").innerHTML = `<h3>${alunoDoc.data().nome}</h3><p>${alunoDoc.data().email}</p>`;

      const lista = document.getElementById("listaProjetosAluno");
      lista.innerHTML = "";
      const snap = await db.collection("projetos").get();
      snap.forEach(doc => {
        const data = doc.data();
        if (data.alunos.includes(id)) {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${data.titulo}</strong>: ${data.descricao}`;
          lista.appendChild(li);
        }
      });
    }

    document.getElementById("btnVoltar").onclick = () => {
      document.getElementById("perfilAluno").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
    };

    // Mostrar login e área pública ao iniciar
    document.getElementById("loginSection").style.display = "block";
    document.getElementById("publicView").style.display = "block";
    listarProjetos();
  </script>
</body>
</html>
